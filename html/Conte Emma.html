<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Princesa Guerrera - Llibre Gamificat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * {
            font-family: 'Century Gothic', 'Trebuchet MS', sans-serif;
        }
        
        body {
            background-color: #f5f1e8;
            min-height: 100vh;
            color: #1a1a1a;
        }
        
        .chapter-container {
            background: #ffffff;
            border: 3px solid #8b7355;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .button-primary {
            background: linear-gradient(135deg, #8b6f47 0%, #a0825c 100%);
            transition: all 0.3s ease;
            border: none;
            border-radius: 8px;
            color: #ffffff;
            font-weight: 600;
            padding: 12px 24px;
            cursor: pointer;
            font-family: 'Century Gothic', 'Trebuchet MS', sans-serif;
        }
        
        .button-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(139, 111, 71, 0.4);
        }
        
        .button-secondary {
            background: #e8dcc8;
            border: 2px solid #8b7355;
            color: #1a1a1a;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Century Gothic', 'Trebuchet MS', sans-serif;
            font-weight: 600;
        }
        
        .button-secondary:hover {
            background: #d9cdb8;
        }
        
        .progress-bar {
            background: linear-gradient(90deg, #8b6f47 0%, #a0825c 100%);
            height: 6px;
            border-radius: 3px;
            transition: width 0.3s ease;
        }
        
        .game-card {
            background: #f9f7f3;
            border: 2px solid #d4c5b9;
            border-radius: 8px;
            padding: 16px;
            margin: 8px 0;
            transition: all 0.3s ease;
            color: #1a1a1a;
        }
        
        .game-card:hover {
            background: #f0ebe3;
            border-color: #8b7355;
        }
        
        .draggable {
            cursor: move;
            user-select: none;
            transition: all 0.2s;
            background: #f0ebe3 !important;
            border: 2px solid #c4b5a0 !important;
        }
        
        .draggable:hover {
            transform: scale(1.02);
            box-shadow: 0 8px 20px rgba(139, 111, 71, 0.3);
        }
        
        .dragging {
            opacity: 0.5;
            transform: scale(0.95);
        }
        
        .drag-over {
            background: #e8dcc8 !important;
            border: 2px solid #8b7355 !important;
        }
        
        .correct {
            background: #c8e6c9 !important;
            border-color: #4caf50 !important;
            color: #2e7d32 !important;
        }
        
        .incorrect {
            background: #ffcdd2 !important;
            border-color: #f44336 !important;
            color: #c62828 !important;
        }
        
        .chapter-image {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            border: 3px solid #8b7355;
            margin: 16px 0;
        }
        
        .result-item {
            background: #f0ebe3;
            border-left: 4px solid #8b7355;
            padding: 12px;
            margin: 8px 0;
            border-radius: 4px;
            color: #1a1a1a;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: 'Century Gothic', 'Trebuchet MS', sans-serif;
            color: #1a1a1a;
        }

        p, div, span {
            font-family: 'Century Gothic', 'Trebuchet MS', sans-serif;
            color: #1a1a1a;
        }

        .drop-zone {
            min-height: 400px;
            border: 2px dashed #8b7355;
            padding: 20px;
            border-radius: 8px;
            background: #fafaf8;
        }

        .sequenced-item {
            background: #e8dcc8;
            border: 2px solid #8b7355;
            padding: 12px;
            margin: 8px 0;
            border-radius: 6px;
            cursor: grab;
            color: #1a1a1a;
        }

        .sequenced-item:active {
            cursor: grabbing;
        }

        .word-grid {
            display: inline-block;
            background: #f9f7f3;
            padding: 10px;
            border-radius: 4px;
            margin: 4px;
            font-weight: bold;
        }

        .grid-cell {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 2px solid #8b7355;
            text-align: center;
            line-height: 40px;
            margin: 2px;
            cursor: pointer;
            background: #ffffff;
            color: #1a1a1a;
            font-weight: bold;
            user-select: none;
            transition: all 0.2s;
        }

        .grid-cell:hover {
            background: #e8dcc8;
            transform: scale(1.05);
        }

        .grid-cell.selected {
            background: #a0825c;
            color: #ffffff;
            border-color: #6b5137;
        }

        .grid-cell.found {
            background: #4caf50;
            color: #ffffff;
            border-color: #2e7d32;
        }

        .word-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 16px;
        }

        .word-badge {
            background: #e8dcc8;
            border: 2px solid #8b7355;
            padding: 8px 12px;
            border-radius: 20px;
            color: #1a1a1a;
            font-weight: bold;
            font-size: 14px;
        }

        .word-badge.completed {
            background: #4caf50;
            color: #ffffff;
            border-color: #2e7d32;
            text-decoration: line-through;
        }

        .option-button {
            background: #f9f7f3;
            border: 2px solid #d4c5b9;
            color: #1a1a1a;
            cursor: pointer;
            transition: all 0.2s;
        }

        .option-button:hover:not(:disabled) {
            background: #e8dcc8;
            border-color: #8b7355;
        }
    </style>
</head>
<body>
    <div id="app" class="min-h-screen py-8 px-4">
        <!-- Progress Bar -->
        <div class="max-w-4xl mx-auto mb-6">
            <div class="flex justify-between mb-2 text-sm" style="color: #8b7355;">
                <span>Progres</span>
                <span id="progress-text">1/13</span>
            </div>
            <div class="bg-gray-300 rounded-full h-2">
                <div class="progress-bar" id="progress-bar" style="width: 7.69%"></div>
            </div>
        </div>

        <!-- Main Content -->
        <div id="content" class="max-w-4xl mx-auto"></div>
    </div>

    <script>
        const APP = {
            currentPage: 0,
            attemptCount: 0,
            maxAttempts: 3,
            draggedItem: null,
            sequenceOrder: [],
            selectedCells: [],
            foundWords: [],
            results: {
                joc1Correct: false,
                joc2Correct: false,
                joc3Scores: []
            },
            
            pages: [
                // Portada
                {
                    type: 'cover',
                    title: 'La Princesa Guerrera',
                    subtitle: 'Una aventura de valentia i descobriment',
                    imageUrl: 'https://files.catbox.moe/4nm0cd.png'
                },
                // Cap√≠tol 1
                {
                    type: 'chapter',
                    title: 'Cap√≠tol 1: La Profecia',
                    image: 'https://files.catbox.moe/c8vvid.png',
                    content: `El sol comen√ßava a amagar-se darrere les muntanyes quan Emma va pujar corrents les escales del palau. El seu cor bategava amb for√ßa, no per l'esfor√ß, sin√≥ per la not√≠cia que acabava d'arribar al castell. A les seves onze anys, la princesa Emma havia crescut entre llibres i lli√ßons de protocol, sempre intentant ser l'exemple perfecte de responsabilitat i amabilitat que esperaven d'ella. Per√≤ aquell vespre, tot estava a punt de canviar.

‚ÄîAltesa! ‚Äîla va cridar Claudia, la seva millor amiga i companya inseparable, corrent darrere d'ella‚Äî. Espera't!

Emma es va aturar davant les portes de la sala del tron. Les seves mans tremolaven lleugerament mentre les posava sobre les enormes manetes de bronze.

‚ÄîHo has sentit, oi? ‚Äîva murmurar Emma sense girar-se‚Äî. El Senyor de les Ombres ha despertat.

Claudia va assentir, posant-li una m√† a l'espatlla. Eren amigues des de petites, i Claudia coneixia cada expressi√≥ del rostre d'Emma.

‚ÄîEl teu pare t'est√† esperant. Sigui el que sigui el que decideixi, jo ser√© al teu costat.

Les dues noies van entrar a la sala, on el rei Jaume estava envoltat dels seus consellers. Entre ells hi havia Marc, el cavaller m√©s valent del regne; Ivet, la s√†via curandera; Ainara, l'arquera de la gu√†rdia reial; i Alex, el mestre d'estrat√®gia. Tots tenien el rostre tensat per la preocupaci√≥.

‚ÄîEmma ‚Äîva dir el rei amb veu greu‚Äî, el Senyor de les Ombres ha enviat les seves criatures a trav√©s de les terres. Segons els exploradors, en tres dies arribar√† als nostres murs amb un ex√®rcit de monstres. T√© una pedra m√†gica que pot esclavitzar tots els habitants del regne.

‚ÄîQu√® podem fer, pare? ‚Äîva preguntar Emma, intentant mantenir la veu ferma malgrat la por que sentia.

El rei va sospirar profundament.

‚ÄîHi ha una llegenda antiga. Diu que nom√©s alg√∫ de sang reial pot arribar fins al Temple dels Quatre Elements i recuperar l'Espasa de la Llum, l'√∫nica arma capa√ß de destruir la pedra fosca. Per√≤ el cam√≠ √©s ple de perills...

‚ÄîJo hi anir√© ‚Äîva dir Emma, sorprenent-se a si mateixa per la rapidesa de la seva resposta.

‚ÄîEmma, ets massa jove ‚Äîva protestar Marc.

‚ÄîNo ho √©s ‚Äîva intervenir Ivet, la curandera, mirant Emma amb uns ulls que semblaven veure m√©s enll√†‚Äî. La profecia parla d'un cor pur i valent. L'edat no hi t√© res a veure.

Aquella mateixa nit, Emma no va poder dormir. Asseguda a la finestra del seu dormitori, mirava les estrelles i dubtava de si mateixa. Com podria ella, que sempre havia estat protegida entre les parets del castell, salvar tot un poble?

‚ÄîPuc entrar? ‚Äîva preguntar Claudia des de la porta.

Emma va assentir, i la seva amiga es va asseure al seu costat.

‚ÄîTinc por, Claudia ‚Äîva admetre Emma en veu baixa‚Äî. Tothom espera que sigui valenta, per√≤ no estig segura de ser-ho.

‚ÄîLa valentia no √©s no tenir por ‚Äîva respondre Claudia‚Äî. √âs actuar malgrat tenir-la. I tu ja has demostrat coratge acceptant aquesta missi√≥.`
                },
                // Cap√≠tol 2
                {
                    type: 'chapter',
                    title: 'Cap√≠tol 2: El Primer Repte',
                    image: 'https://files.catbox.moe/2jna7u.png',
                    content: `A l'alba, un petit grup es va reunir a les portes del castell. Emma portava una armadura lleugera que Ainara havia adaptat per a ella. Al seu costat hi havia Claudia, Marc, Ivet, Ainara i Alex. Tamb√© els acompanyaven Juno i Ar√ß, dos joves guerrers que s'havien oferit voluntaris, i Jana i Guillem, experts coneixedors dels boscos i muntanyes.

El primer tram del viatge va ser tranquil. Travessaven els camps verds del regne quan Jana, que anava al capdavant, va al√ßar la m√† per aturar-los.

‚ÄîEscolteu ‚Äîva murmurar.

Un gruny profund va ressonar entre els arbres. De sobte, tres ogres enormes van sortir del bosc, bloquejant-los el cam√≠. Tenien la pell verdosa i ulls vermells que brillaven amb mal√≠cia.

‚ÄîPrincesa, queda't darrere! ‚Äîva cridar Marc, desenfundant l'espasa.

Els ogres van atacar. Marc i Ar√ß van lluitar valents, per√≤ eren massa forts. Un dels monstres va fer volar Marc amb un cop del seu ma√ßa, deixant-lo inconscient a terra. Ivet va c√≥rrer a curar-lo mentre Ainara disparava fletxes que semblaven no fer-los massa mal.

Emma va veure com Juno era llan√ßat contra un arbre i Guillem quedava atrapat sota el peu d'un dels ogres. La por la paralitzava, per√≤ llavors va sentir la veu de Claudia:

‚ÄîEmma, la gent necessita que siguis valenta! Pots fer-ho!

Alguna cosa es va despertar dins d'Emma. Va agafar una espasa caiguda i, sense pensar-ho dues vegades, va c√≥rrer cap a l'ogre que tenia atrapat Guillem. Va recordar les lli√ßons de Marc sobre punts febles i va apuntar al turmell del monstre. La seva estocada va ser precisa. L'ogre va cridar de dolor i va deixar anar Guillem.

Els altres ogres es van girar cap a ella, furiosos. Emma va respirar fondo, intentant controlar els tremolors de les seves mans.

‚ÄîVinga, monstres! ‚Äîva cridar, i va comen√ßar a moure's √†gilment, esquivant els cops mentre els altres es recuperaven.

Finalment, treballant junts, van aconseguir derrotar els tres ogres. Quan tot va acabar, Emma estava exhausta, amb les mans encara tremolant per l'adrenalina.

‚ÄîHas estat incre√Øble! ‚Äîva exclamar Claudia, abra√ßant-la.

‚ÄîNo m'ho puc creure ‚Äîva murmurar Emma‚Äî. Ho he fet de deb√≤?

Marc, encara recuperant-se dels cops, va somriure.

‚ÄîHas salvat Guillem i has liderat el contraatac. Potser ets m√©s guerrera del que pensaves, princesa.`
                },
                // Joc 1: Ordenar Seq√º√®ncia
                {
                    type: 'game',
                    title: 'Joc 1: Ordena la Seq√º√®ncia',
                    gameType: 'sequencing',
                    description: 'Ordena les frases seg√ºents que resumeixen els esdeveniments principals dels cap√≠tols 1 i 2:',
                    items: [
                        'Emma rep la not√≠cia que el Senyor de les Ombres ha despertat',
                        'El rei li explica que ha de trobar l\'Espasa de la Llum al Temple dels Quatre Elements',
                        'Emma es junta amb el seu grup al castells',
                        'El grup √©s atacat per tres ogres als boscos',
                        'Emma descobreix el seu coratge en salvar Guillem',
                        'La vict√≤ria obre el cam√≠ cap a noves aventures'
                    ],
                    correctOrder: [0, 1, 2, 3, 4, 5]
                },
                // Cap√≠tol 3
                {
                    type: 'chapter',
                    title: 'Cap√≠tol 3: El Bosc dels Xiuxiueigs',
                    image: 'https://files.catbox.moe/cpqeft.png',
                    content: `Despr√©s de dos dies de cam√≠, van arribar al Bosc dels Xiuxiueigs, un lloc on es deia que els arbres estaven vius i podien llegir els pensaments. L'aire era esp√®s i una boira grisa ho cobria tot.

‚ÄîAnem amb compte ‚Äîva advertir Jana‚Äî. Aquest lloc pot fer-te veure les teves pitjors pors.

Mentre avan√ßaven, van comen√ßar a sentir veus. Emma va veure siluetes entre la boira que semblaven persones del seu poble, cridant-la, acusant-la de no ser prou forta per salvar-los.

‚ÄîNo s√≥n reals ‚Äîli va recordar Alex‚Äî. √âs la m√†gia del bosc.

Per√≤ llavors van apar√®ixer criatures de fang i ombra, materialitzant-se de la mateixa boira. Eren els Espectres del Dubte, √©ssers que s'alimentaven de la inseguretat.

‚ÄîAtaquen la ment abans que el cos! ‚Äîva cridar Ivet‚Äî. Heu de mantenir la confian√ßa en vosaltres mateixos!

Els espectres envoltaven Emma, xiuxiuejant-li a l'orella: "Ets massa d√®bil. Fallar√†s. El teu poble morir√† per culpa teva."

Emma va tancar els ulls, recordant tot el que havia passat. Els ogres. Com havia superat la seva por. Com havia salvat Guillem. Totes les vegades que havia ajudat la gent al castell, escoltant els seus problemes, trobant solucions.

‚ÄîNo ‚Äîva dir en veu alta, obrint els ulls amb determinaci√≥‚Äî. S√≥c m√©s forta del que pensava. I seguir√© lluitant!

Una llum c√†lida va comen√ßar a brillar al voltant d'Emma. Els espectres van cridar i es van dissoldre davant aquella llum pura que naixia del seu cor.

‚ÄîLa llum de la teva convicci√≥ els ha destru√Øt! ‚Äîva exclamar Ivet, meravellada‚Äî. Emma, portes la m√†gia dins teu!

Un a un, inspirats per Emma, tots van trobar la for√ßa per enfrontar-se als seus propis dubtes. Els espectres van desapar√®ixer i la boira es va aixecar, revelant el cam√≠ cap endavant.

Aquella nit, mentre descansaven al voltant del foc, Claudia va asseure's al costat d'Emma.

‚ÄîCada vegada estig m√©s orgullosa de tu ‚Äîva dir‚Äî. Has canviat tant des que vam sortir del castell.

‚ÄîNo he canviat ‚Äîva respondre Emma, pensativa‚Äî. Simplement estig descobrint qui s√≥c de veritat. Sempre he pensat que ser responsable i amable significava ser d√®bil. Per√≤ ara veig que pot conviure amb la for√ßa i la valentia.`
                },
                // Cap√≠tol 4
                {
                    type: 'chapter',
                    title: 'Cap√≠tol 4: El Drac de Gel',
                    image: 'https://files.catbox.moe/ay6a1w.png',
                    content: `L'endem√† van arribar al peu de les Muntanyes de Cristall, on segons la llegenda es trobava el Temple dels Quatre Elements. Per√≤ guardant l'entrada hi havia Morgath, un bruixot al servei del Senyor de les Ombres.

‚ÄîAix√≠ que la princeseta ha arribat fins aqu√≠ ‚Äîva riure Morgath, la seva veu sonant com vidre trencat‚Äî. Impressionant. Per√≤ aqu√≠ acaba el teu viatge.

Morgath va invocar un drac de gel, una criatura immensa amb escates transl√∫cides i al√® gla√ßat. El monstre va rugir, fent tremolar la muntanya.

‚ÄîAix√≤ √©s massa per a nosaltres! ‚Äîva cridar Ar√ß.

El drac va atacar, i el grup es va dispersar. Ainara disparava fletxes que rebotaven contra les escates de gel. Marc intentava apropar-se, per√≤ l'al√® gla√ßat del drac el mantenia a dist√†ncia. Ivet curava els ferits tan r√†pid com podia.

Emma observava la batalla, buscant una estrat√®gia. Va recordar les lli√ßons d'Alex sobre trobar els punts febles de l'enemic. I llavors ho va veure: el drac protegia especialment el costat esquerre del seu coll.

‚ÄîAll√† hi ha el seu punt feble! ‚Äîva cridar‚Äî. Per√≤ necessitem una distracci√≥!

‚ÄîAix√≤ ho puc fer jo ‚Äîva dir Claudia, agafant una torxa.

‚Äî√âs massa perill√≥s! ‚Äîva protestar Emma.

‚ÄîConfia en mi, com jo confio en tu ‚Äîva respondre Claudia amb un somriure.

Emma va assentir. Va elaborar r√†pidament un pla, assignant tasques a cadascun. Jana i Guillem crearien confusi√≥ des dels flancs. Marc, Juno i Ar√ß atacarien de front. Ainara i Alex donarien suport des de la dist√†ncia. I Emma i Claudia executarien l'atac final.

El pla es va posar en marxa. Mentre els altres distreien el drac, Emma i Claudia van escalar per un costat de la muntanya. Morgath, massa confiat en la seva criatura, no les va veure arribar.

‚ÄîAra! ‚Äîva cridar Emma.

Les dues amigues van saltar des d'una cornisa, amb Emma apuntant directament al punt feble del coll del drac. La seva espasa va traspassar les escates, i el monstre va rugir de dolor abans de desintegrar-se en una pluja de cristalls de gel.

Morgath, furi√≥s, va intentar atacar-les amb m√†gia fosca, per√≤ Ivet va crear un escut protector mentre Marc es llan√ßava contra el bruixot. La batalla va ser intensa, per√≤ finalment Morgath va fugir, derrotat.

‚ÄîHo hem aconseguit! ‚Äîva exclamar Juno.`
                },
                // Joc 2: Sopa de Lletres
                {
                    type: 'game',
                    title: 'Joc 2: Sopa de Lletres',
                    gameType: 'wordsearch',
                    description: 'Clica els grups de lletres per trobar les 5 paraules clau dels cap√≠tols 3 i 4: DUBTE, DRAC, LLUM, CORATGE, MORGATH',
                    words: ['DUBTE', 'DRAC', 'LLUM', 'CORATGE', 'MORGATH'],
                    grid: [
                        ['D', 'U', 'B', 'T', 'E', 'X', 'Y', 'Z', 'K', 'L'],
                        ['M', 'O', 'R', 'G', 'A', 'T', 'H', 'P', 'Q', 'U'],
                        ['D', 'R', 'A', 'C', 'W', 'S', 'V', 'N', 'M', 'M'],
                        ['L', 'L', 'U', 'M', 'T', 'J', 'K', 'L', 'I', 'H'],
                        ['C', 'O', 'R', 'A', 'T', 'G', 'E', 'F', 'D', 'B'],
                        ['P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y']
                    ]
                },
                // Cap√≠tol 5
                {
                    type: 'chapter',
                    title: 'Cap√≠tol 5: El Temple dels Quatre Elements',
                    image: 'https://files.catbox.moe/317o05.png',
                    content: `Van entrar al Temple dels Quatre Elements, un lloc m√†gic on l'aire, el foc, l'aigua i la terra es trobaven en perfecte equilibri.

Al centre del temple hi havia un pedestal, i sobre ell, l'Espasa de la Llum. Per√≤ quan Emma es va apropar, una veu va ressonar per tot el temple.

‚ÄîNom√©s qui sigui digne pot aixecar l'espasa. Demostra que tens el cor pur, la ment clara, la for√ßa necess√†ria i l'esperit indomable.

Quatre proves van apar√®ixer davant d'Emma. La primera era una prova d'aigua: havia de creuar un riu de records, revivint moments dolorosos del seu passat sense deixar-se arrossegar per ells. Emma va caminar per l'aigua, veient com revivia moments de dubte i por, per√≤ acceptant-los com a part d'ella mateixa.

La segona prova era de foc: havia d'enfrontar-se a una il¬∑lusi√≥ del Senyor de les Ombres, que prenia la forma dels seus pitjors temors. Emma va respirar fondo i va recordar tot el que havia apr√®s. No va fugir de la por, sin√≥ que la va abra√ßar i la va superar.

La tercera prova era d'aire: havia de respondre tres endevinalles sobre la naturalesa del coratge. Emma va pensar en tot el que havia viscut durant el viatge i va trobar les respostes en la seva pr√≤pia experi√®ncia.

La quarta prova era de terra: havia de demostrar la seva connexi√≥ amb el poble que volia salvar. Emma va tancar els ulls i va pensar en cada persona del regne, en les seves hist√≤ries, en les seves esperances. Va sentir el seu amor pel seu poble fluint a trav√©s d'ella.

Quan va obrir els ulls, l'Espasa de la Llum brillava davant d'ella. La va agafar, i una energia c√†lida va rec√≥rrer tot el seu cos.

‚ÄîHo has aconseguit! ‚Äîva cridar Claudia, amb ll√†grimes d'alegria als ulls.`
                },
                // Cap√≠tol 6
                {
                    type: 'chapter',
                    title: 'Cap√≠tol 6: La Batalla Final',
                    image: 'https://files.catbox.moe/xdix96.png',
                    content: `No hi havia temps per celebracions. Havien de tornar r√†pidament al castell. El Senyor de les Ombres ja havia arribat amb el seu ex√®rcit.

El viatge de tornada va ser una cursa contra el temps. Quan finalment van arribar al regne, el cel estava fosc i les forces del mal envoltaven el castell. El Senyor de les Ombres era una figura immensa de foscor pura, amb la pedra negra brillant al seu pit.

‚ÄîHe arribat tard! ‚Äîva exclamar Emma, veient com les defenses del castell feien fallida.

‚ÄîNo ‚Äîva dir Marc‚Äî. Has arribat just a temps. El teu pare ha aconseguit resistir fins ara.

Emma va mirar la seva gent lluitant valientemente. Va veure el seu pare defensant les muralles, els seus soldats caient per√≤ aixecant-se de nou. I va entendre que la valentia no era nom√©s cosa d'una persona, sin√≥ de tot un poble unit.

‚ÄîAnem-hi! ‚Äîva cridar Emma, aixecant l'Espasa de la Llum.

La batalla va ser ferotge. Emma va liderar l'atac, i la seva espasa tallava la foscor com si fos mantega. Els seus companys lluitaven al seu costat: Claudia protegia el seu flanc, Marc comandava els soldats, Ivet curava els ferits, Ainara disparava fletxes m√†giques, Alex coordinava la defensa, i Jana, Guillem, Juno i Ar√ß lluitaven amb tot el seu coratge.

Finalment, Emma va arribar davant el Senyor de les Ombres.

‚ÄîUna nena? ‚Äîva riure l'√©sser fosc‚Äî. Aix√≤ √©s el millor que pot oferir aquest regne pat√®tic?

‚ÄîAquesta nena ha apr√®s m√©s durant aquest viatge que tu en tota la teva exist√®ncia ‚Äîva respondre Emma, ferma‚Äî. He apr√®s que la valentia no √©s l'abs√®ncia de por, sin√≥ actuar malgrat tenir-la. He apr√®s que s√≥c molt m√©s forta del que pensava. I he apr√®s que amb amics de veritat i un prop√≤sit just, res √©s impossible.

Emma va atacar. La seva espasa de llum va xocar contra la foscor del Senyor de les Ombres. Era una batalla entre el b√© i el mal, entre l'esperan√ßa i la desesperaci√≥. Emma va recordar cada prova superada, cada moment de dubte ven√ßut, cada vegada que havia descobert una nova for√ßa dins seu.

Amb un √∫ltim esfor√ß, va clavar l'Espasa de la Llum directament a la pedra negra. Una explosi√≥ de llum va il¬∑luminar tot el camp de batalla. El Senyor de les Ombres va cridar abans de desintegrar-se, i amb ell, tot el seu ex√®rcit va desapar√®ixer.

El silenci va caure sobre el camp de batalla. I llavors, els crits de vict√≤ria van esclatar per tot arreu.`
                },
                // Cap√≠tol 7
                {
                    type: 'chapter',
                    title: 'Cap√≠tol 7: El Retorn',
                    image: 'https://files.catbox.moe/m51siw.png',
                    content: `Emma, exhausta, va caure de genolls. Claudia va c√≥rrer cap a ella, abra√ßant-la.

‚ÄîHo has fet! Has salvat el regne!

Els dies seg√ºents van ser de celebraci√≥. El rei Jaume va organitzar un gran banquet, i tothom va reunir-se per honrar Emma i els seus companys.

Per√≤ la nit de la celebraci√≥, Emma es va escapar un moment a la seva habitaci√≥ del castell. Es va mirar al mirall i gaireb√© no es va recon√®ixer. La noia que veia davant seu ja no era la princesa t√≠mida i insegura que havia partit feia dies. Era alg√∫ nou, alg√∫ que havia descobert la seva pr√≤pia for√ßa.

Claudia va entrar a l'habitaci√≥.

‚ÄîT'estan esperant per al brindis ‚Äîva dir, i llavors va afegir‚Äî: Com et sents?

Emma va somriure.

‚ÄîSento que finalment he ent√®s qui s√≥c. Durant tant de temps vaig pensar que havia de ser d'una manera determinada per ser una bona princesa. Responsable, amable, per√≤ sempre protegida. Ara s√© que puc ser tot aix√≤ i, alhora, ser valenta, forta i capa√ß d'enfrontar-me a qualsevol repte.

‚ÄîI qu√® far√†s ara? ‚Äîva preguntar Claudia.

‚ÄîAra? ‚ÄîEmma va mirar per la finestra cap al seu regne, on la gent celebrava‚Äî. Ara continuar√© creixent, aprenent, sent la millor versi√≥ de mi mateixa. Perqu√® he descobert que el viatge de con√®ixer-te a tu mateix mai s'acaba. I aix√≤ √©s el m√©s emocionant de tot.

Les dues amigues van tornar al sal√≥, on tothom les esperava. El rei va al√ßar la seva copa.

‚ÄîBrindem per la meva filla Emma, la Princesa Guerrera, que ens ha ensenyat que la veritable valentia neix del cor i que tots som m√©s forts del que pensem!

‚ÄîPer Emma! ‚Äîvan cridar tots a l'un√≠son.

I aix√≠, Emma va aprendre la lli√ß√≥ m√©s important de totes: que dins de cada persona hi ha una for√ßa immensa esperant ser descoberta, que la valentia es troba en els moments m√©s foscos, i que amb const√†ncia, esfor√ß i confian√ßa en un mateix, es pot superar qualsevol obstacle. El poble va poder viure feli√ß, protegit per una princesa que ara sabia que era tant guerrera com diplom√†tica, tant forta com amable, i sobretot, capa√ß de coses extraordin√†ries.

I cada nit, abans d'adormir-se, Emma recordava les paraules que Claudia li havia dit aquell primer vespre: "La valentia no √©s no tenir por, √©s actuar malgrat tenir-la." I somreia, sabent que aquelles paraules l'acompanyarien per sempre en cada nova aventura que la vida li present√©s.`
                },
                // Joc 3: Q√ºestionari Final
                {
                    type: 'game',
                    title: 'Q√ºestionari Final',
                    gameType: 'multiple-choice',
                    description: 'Respon les seg√ºents preguntes per demostrar la teva comprensi√≥ de tota la hist√≤ria:',
                    questions: [
                        {
                            question: '¬øQuin √©s el nom de la millor amiga d\'Emma?',
                            options: ['Ivet', 'Claudia', 'Ainara', 'Jana'],
                            correct: 1
                        },
                        {
                            question: '¬øQuina √©s l\'arma que Emma ha de trobar per derrotar el Senyor de les Ombres?',
                            options: ['L\'Espasa de Foc', 'L\'Espasa de la Llum', 'L\'Espasa del B√©', 'L\'Espasa dels Elements'],
                            correct: 1
                        },
                        {
                            question: '¬øA quin lloc Emma ha de viure les seves pitjors pors materialitzades?',
                            options: ['Al Bosc dels Xiuxiueigs', 'Muntanyes de Cristall', 'Temple dels Quatre Elements', 'Riu de Records'],
                            correct: 0
                        },
                        {
                            question: '¬øQuina √©s la lli√ß√≥ m√©s important que Emma apr√®n durant la seva aventura?',
                            options: ['La for√ßa f√≠sica √©s m√©s important que les amistats', 'La valentia no √©s l\'abs√®ncia de por, sin√≥ actuar malgrat tenir-la', 'El poder est√† en la c√†rrega m√†gica que poses', 'Els pr√≠nceps sempre neixen valents'],
                            correct: 1
                        },
                        {
                            question: '¬øQuin bruixot invoca el drac de gel?',
                            options: ['Alex', 'Morgath', 'Jaume', 'Marc'],
                            correct: 1
                        }
                    ]
                },
                // Resultats Finals
                {
                    type: 'results',
                    title: 'Resum del Teu Rendiment'
                }
            ],

            init() {
                this.render();
            },

            render() {
                const page = this.pages[this.currentPage];
                const content = document.getElementById('content');
                
                switch(page.type) {
                    case 'cover':
                        content.innerHTML = this.renderCover(page);
                        break;
                    case 'chapter':
                        content.innerHTML = this.renderChapter(page);
                        break;
                    case 'game':
                        content.innerHTML = this.renderGame(page);
                        break;
                    case 'results':
                        content.innerHTML = this.renderResults(page);
                        break;
                }
                
                this.updateProgress();
            },

            renderCover(page) {
                return `
                    <div class="chapter-container p-12 text-center">
                        <div class="fade-in">
                            <img src="${page.imageUrl}" alt="${page.title}" class="chapter-image mx-auto mb-8" style="max-width: 300px;">
                            <h1 class="text-5xl font-bold mb-4" style="color: #8b6f47;">${page.title}</h1>
                            <p class="text-2xl mb-8" style="color: #1a1a1a;">${page.subtitle}</p>
                            <p class="text-lg mb-8" style="color: #555;">Prepara't per a una aventura √®pica!</p>
                            <button onclick="APP.nextPage()" class="button-primary">Comen√ßa l'aventura</button>
                        </div>
                    </div>
                `;
            },

            renderChapter(page) {
                return `
                    <div class="chapter-container p-8 fade-in">
                        <h2 class="text-4xl font-bold mb-6" style="color: #8b6f47;">${page.title}</h2>
                        <img src="${page.image}" alt="${page.title}" class="chapter-image">
                        <div class="text-lg leading-relaxed mb-8 whitespace-pre-wrap">
                            ${page.content}
                        </div>
                        <div class="flex gap-4">
                            <button onclick="APP.previousPage()" class="button-secondary" ${this.currentPage === 1 ? 'style="display:none"' : ''}>Anterior</button>
                            <button onclick="APP.nextPage()" class="button-primary ml-auto">Seg√ºent</button>
                        </div>
                    </div>
                `;
            },

            renderGame(page) {
                let gameHTML = `
                    <div class="chapter-container p-8 fade-in">
                        <h2 class="text-4xl font-bold mb-4" style="color: #8b6f47;">${page.title}</h2>
                        <p class="text-lg mb-6" style="color: #555;">${page.description}</p>
                `;

                if(page.gameType === 'sequencing') {
                    gameHTML += this.renderSequencingGame(page);
                } else if(page.gameType === 'wordsearch') {
                    gameHTML += this.renderWordSearchGame(page);
                } else if(page.gameType === 'multiple-choice') {
                    gameHTML += this.renderMultipleChoiceGame(page);
                }

                gameHTML += `
                        <div id="feedback" class="mt-6"></div>
                        <div class="flex gap-4 mt-8">
                            <button onclick="APP.previousPage()" class="button-secondary">Anterior</button>
                            <button id="next-btn" onclick="APP.nextPage()" class="button-primary ml-auto">Seg√ºent</button>
                        </div>
                    </div>
                `;
                return gameHTML;
            },

            renderSequencingGame(page) {
                let html = '<div id="game-container" class="mt-6">';
                html += '<div id="available-items" class="mb-6">';
                html += '<h3 class="text-lg font-bold mb-4" style="color: #8b6f47;">Arrossega els elements de l\'esquerra a la dreta per ordenar-los:</h3>';
                
                html += '<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">';
                html += '<div>';
                page.items.forEach((item, index) => {
                    html += `
                        <div class="sequenced-item draggable" draggable="true" data-index="${index}" 
                             ondragstart="APP.dragStart(event)" ondragend="APP.dragEnd(event)">
                            ${index + 1}. ${item}
                        </div>
                    `;
                });
                html += '</div>';
                
                html += '<div>';
                html += '<div id="drop-zone" class="drop-zone" ondrop="APP.drop(event)" ondragover="APP.allowDrop(event)" ondragleave="APP.dragLeave(event)">';
                html += '<p style="color: #999;">Arrossega els elements aqu√≠ en l\'ordre correcte</p>';
                html += '</div>';
                html += '</div>';
                html += '</div>';
                
                html += '<button onclick="APP.checkSequence()" class="button-secondary mt-4">Verificar</button>';
                html += '</div>';
                
                return html;
            },

            renderWordSearchGame(page) {
                let html = '<div class="mt-6">';
                html += '<div class="mb-6"><h3 class="text-lg font-bold mb-3" style="color: #8b6f47;">Paraules a trobar:</h3>';
                html += '<div class="word-list">';
                page.words.forEach(word => {
                    html += `<span class="word-badge" data-word="${word}">${word}</span>`;
                });
                html += '</div></div>';
                
                html += '<div style="margin: 20px 0; text-align: center;">';
                page.grid.forEach((row, rowIndex) => {
                    row.forEach((letter, colIndex) => {
                        html += `<span class="grid-cell" onclick="APP.toggleCell(${rowIndex}, ${colIndex})" data-row="${rowIndex}" data-col="${colIndex}">${letter}</span>`;
                    });
                    html += '<br>';
                });
                html += '</div>';
                
                html += '<button onclick="APP.checkWordSearch()" class="button-secondary mb-4">Marcar com a completat</button>';
                html += '<div id="found-words" class="text-base mt-4"></div>';
                
                html += '</div>';
                return html;
            },

            renderMultipleChoiceGame(page) {
                let html = '<div id="game-container" class="mt-6">';
                
                page.questions.forEach((q, qIndex) => {
                    html += `
                        <div class="game-card mb-6">
                            <h3 class="text-lg font-bold mb-4" style="color: #8b6f47;">Pregunta ${qIndex + 1}: ${q.question}</h3>
                            <div class="space-y-3">
                    `;
                    
                    q.options.forEach((option, oIndex) => {
                        html += `
                            <button class="w-full text-left game-card option-button" data-question="${qIndex}" data-option="${oIndex}">
                                <span style="color: #8b6f47; font-weight: bold;">${String.fromCharCode(65 + oIndex)}.</span> ${option}
                            </button>
                        `;
                    });
                    
                    html += '</div></div>';
                });
                
                html += '</div>';
                
                setTimeout(() => {
                    document.querySelectorAll('.option-button').forEach(btn => {
                        btn.addEventListener('click', (e) => APP.selectAnswer(e));
                    });
                }, 100);
                
                return html;
            },

            renderResults(page) {
                let totalScore = 0;
                let totalPossible = 0;

                if(this.results.joc1Correct) totalScore += 1;
                totalPossible += 1;

                if(this.results.joc2Correct) totalScore += 1;
                totalPossible += 1;

                const joc3Score = this.results.joc3Scores.filter(r => r).length;
                totalScore += joc3Score;
                totalPossible += 5;

                const percentage = Math.round((totalScore / totalPossible) * 100);

                return `
                    <div class="chapter-container p-8 fade-in">
                        <h2 class="text-4xl font-bold mb-6" style="color: #8b6f47;">Felicitats!</h2>
                        
                        <div style="background: linear-gradient(135deg, #e8dcc8 0%, #d9cdb8 100%); border: 3px solid #8b7355; padding: 32px; border-radius: 12px; margin-bottom: 32px; text-align: center;">
                            <p class="mb-2" style="color: #666;">La teva puntuaci√≥</p>
                            <p class="text-5xl font-bold" style="color: #8b6f47;">${totalScore}/${totalPossible}</p>
                            <p class="text-2xl mt-2" style="color: #8b6f47;">${percentage}%</p>
                        </div>

                        <div class="space-y-4 mb-8">
                            <div class="result-item">
                                <strong style="color: #8b6f47;">Joc 1: Ordenar Seq√º√®ncia</strong>
                                <p>${this.results.joc1Correct ? '‚úÖ Correcte' : '‚ùå No completat'}</p>
                            </div>
                            <div class="result-item">
                                <strong style="color: #8b6f47;">Joc 2: Sopa de Lletres</strong>
                                <p>${this.results.joc2Correct ? '‚úÖ Correcte' : '‚ùå No completat'}</p>
                            </div>
                            <div class="result-item">
                                <strong style="color: #8b6f47;">Q√ºestionari Final</strong>
                                <p>‚úÖ ${joc3Score} de 5 preguntes correctes</p>
                            </div>
                        </div>

                        <p class="text-lg mb-8">
                            ${percentage >= 80 ? 'üéâ Genia! Has demostrat ser un aut√®ntic expert en aquesta hist√≤ria!' : 
                              percentage >= 60 ? 'üëè Molt b√©! Tens una bona comprensi√≥ de la hist√≤ria.' : 
                              'üìö Has appres molt! Recorda que l\'aprenentatge √©s un viatge continu.'}
                        </p>

                        <button onclick="APP.downloadReport()" class="button-primary mb-4">Descarrega Informe</button>
                        <button onclick="APP.restart()" class="button-secondary ml-4">Comen√ßa de nou</button>
                    </div>
                `;
            },

            updateProgress() {
                const progress = ((this.currentPage) / (this.pages.length - 1)) * 100;
                document.getElementById('progress-bar').style.width = progress + '%';
                document.getElementById('progress-text').textContent = `${this.currentPage + 1}/${this.pages.length}`;
            },

            nextPage() {
                if(this.currentPage < this.pages.length - 1) {
                    this.currentPage++;
                    this.sequenceOrder = [];
                    this.selectedCells = [];
                    this.render();
                    window.scrollTo(0, 0);
                }
            },

            previousPage() {
                if(this.currentPage > 0) {
                    this.currentPage--;
                    this.sequenceOrder = [];
                    this.selectedCells = [];
                    this.render();
                    window.scrollTo(0, 0);
                }
            },

            dragStart(event) {
                this.draggedItem = event.target;
                event.target.classList.add('dragging');
                event.dataTransfer.effectAllowed = 'move';
            },

            dragEnd(event) {
                event.target.classList.remove('dragging');
            },

            allowDrop(event) {
                event.preventDefault();
                event.dataTransfer.dropEffect = 'move';
                event.currentTarget.classList.add('drag-over');
            },

            dragLeave(event) {
                event.currentTarget.classList.remove('drag-over');
            },

            drop(event) {
                event.preventDefault();
                const dropZone = document.getElementById('drop-zone');
                dropZone.classList.remove('drag-over');
                
                if(this.draggedItem) {
                    const clone = this.draggedItem.cloneNode(true);
                    clone.style.opacity = '1';
                    clone.draggable = false;
                    clone.style.cursor = 'default';
                    dropZone.appendChild(clone);
                    
                    const index = parseInt(this.draggedItem.dataset.index);
                    this.sequenceOrder.push(index);
                }
            },

            checkSequence() {
                const page = this.pages[this.currentPage];
                const feedback = document.getElementById('feedback');
                
                if(this.sequenceOrder.length === 0) {
                    feedback.innerHTML = '<p class="font-bold" style="color: #f59e0b;">‚ö†Ô∏è Si us plau, arrossega els elements a la zona de soluci√≥</p>';
                    return;
                }
                
                const isCorrect = JSON.stringify(this.sequenceOrder) === JSON.stringify(page.correctOrder);
                
                if(isCorrect) {
                    this.results.joc1Correct = true;
                    feedback.innerHTML = '<p class="font-bold" style="color: #22c55e;">‚úÖ Excel¬∑lent! Has ordenat correctament tots els esdeveniments!</p>';
                } else {
                    feedback.innerHTML = '<p class="font-bold" style="color: #f59e0b;">‚ö†Ô∏è No √©s l\'ordre correcte. Prova de nou o segueix amb el bot√≥ Seg√ºent.</p>';
                }
            },

            toggleCell(row, col) {
                const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
                cell.classList.toggle('selected');
            },

            checkWordSearch() {
                this.results.joc2Correct = true;
                document.getElementById('feedback').innerHTML = '<p class="font-bold" style="color: #22c55e;">‚úÖ Excel¬∑lent! Joc completat!</p>';
            },

            selectAnswer(event) {
                const button = event.target.closest('.option-button');
                if(!button) return;

                const questionIndex = parseInt(button.dataset.question);
                const optionIndex = parseInt(button.dataset.option);
                const page = this.pages[this.currentPage];
                const correctIndex = page.questions[questionIndex].correct;

                button.classList.add(optionIndex === correctIndex ? 'correct' : 'incorrect');
                
                if(optionIndex !== correctIndex) {
                    const correctBtn = document.querySelector(`.option-button[data-question="${questionIndex}"][data-option="${correctIndex}"]`);
                    if(correctBtn) correctBtn.classList.add('correct');
                }

                if(!this.results.joc3Scores[questionIndex]) {
                    this.results.joc3Scores[questionIndex] = optionIndex === correctIndex;
                }

                document.querySelectorAll(`.option-button[data-question="${questionIndex}"]`).forEach(b => {
                    b.style.pointerEvents = 'none';
                    b.style.opacity = '0.7';
                });
            },

            downloadReport() {
                const report = document.documentElement.outerHTML;
                const element = document.createElement("a");
                element.setAttribute("href", "data:text/html;charset=utf-8," + encodeURIComponent(report));
                element.setAttribute("download", "informe_princesa_guerrera.html");
                element.click();
            },

            restart() {
                this.currentPage = 0;
                this.sequenceOrder = [];
                this.selectedCells = [];
                this.foundWords = [];
                this.results = {
                    joc1Correct: false,
                    joc2Correct: false,
                    joc3Scores: []
                };
                this.render();
            }
        };

        APP.init();
    </script>
</body>
</html>